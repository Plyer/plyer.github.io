name: build

on:
  workflow_dispatch:
  push:
    branches:
    - master
  
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: true

    - name: Update Blog Content
      #env:
        #GH_TOKEN: ${{ secrets.MY_TOKEN }}
      run: |
        git submodule update --init --remote
        
    - name: Setup Hugo
      uses: peaceiris/actions-hugo@v2
      with:
          hugo-version: "latest"
          extended: true

    - name: Build
      run: hugo --minify --gc

    - name: ä¸Šä¼ ä¸ƒç‰›äº‘
      uses: luochongfei/up2qn@master
      with:
        bucket: plyer-blog # ç©ºé—´åç§°ï¼ŒæŒ‰å®é™…æƒ…å†µå¡«å†™
        zone: åä¸œ # å­˜å‚¨åŒºåŸŸï¼ŒæŒ‰å®é™…æƒ…å†µå¡«å†™ å¤‡æ³¨1
        access_key: ${{ secrets.QiNiu_AK }} # ä¸ƒç‰›äº‘ AccessKey å¤‡æ³¨2
        secret_key: ${{ secrets.QiNiu_SK }} # ä¸ƒç‰›äº‘ SecretKey å¤‡æ³¨2
        local_dir: public # æœ¬åœ°æ–‡ä»¶å¤¹
        #local_exclude: "**/node_modules/**" # è¦æ’é™¤çš„å†…å®¹ï¼Œè¦ç¬¦åˆ glob æ ¼å¼
        target_dir: / # è¦ä¸Šä¼ åˆ°ä¸ƒç‰›äº‘ä¸­çš„æ–‡ä»¶å¤¹  

    - name: Deploy ğŸš€
      uses: JamesIves/github-pages-deploy-action@v4
      with:
          branch: gh-pages
          folder: public
          clean: true
          single-commit: true
          
#    - name: åˆ é™¤ hugo ç”Ÿæˆçš„é™æ€æ–‡ä»¶
#      run: |
#        rm -rf public
#        git config --global user.name "github-actions[bot]"
#        git config --global user.email "github-actions[bot]@email.com"
#        git add .
#        git commit -m "Update Blog Content And Delete Path public"
#        git push
    
